

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Custom Database Tables &mdash; Home</title>
    
    <link rel="stylesheet" href="../_static/cyclus.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '(1.3.0-rc1-22-ge0c3114)',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/cloud.js"></script>
    <link rel="shortcut icon" href="../_static/big_c.ico"/>
    <link rel="top" title="Home" href="../index.html" />
    <link rel="up" title="Cyclus Archetype Developer Guide" href="index.html" />
    <link rel="next" title="Errors and Warnings" href="errors.html" />
    <link rel="prev" title="Database Types" href="dbtypes.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1"><script type="text/javascript">
var ga_enabled = !$.cookie('disable-ga');
if(ga_enabled){
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12222727-2']);
  _gaq.push(['_setCookiePath', '/']);
  _gaq.push(['_setDetectFlash', false]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}
</script>
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="errors.html" title="Errors and Warnings"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="dbtypes.html" title="Database Types"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &raquo;</li>

          <li><a href="index.html" accesskey="U"><span style="font-variant:small-caps;">Cyclus</span> Archetype Developer Guide</a> &raquo;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="custom-database-tables">
<h1>Custom Database Tables<a class="headerlink" href="#custom-database-tables" title="Permalink to this headline">¶</a></h1>
<p>Agents are allowed to write their own custom output into the database during
simulations.  The interface for recording this data is accessible through the
agent&#8217;s <a class="reference internal" href="../basics/glossary.html#term-context"><em class="xref std std-term">context</em></a>.  Data may be logged via the Context::NewDatum function:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">MyReactor</span><span class="o">::</span><span class="n">Tick</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="kt">double</span> <span class="n">monthly_water</span> <span class="o">=</span> <span class="p">...;</span>
  <span class="kt">double</span> <span class="n">monthly_op_cost</span> <span class="o">=</span> <span class="p">...;</span>

  <span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NewDatum</span><span class="p">(</span><span class="s">&quot;MyReactorData&quot;</span><span class="p">)</span>
           <span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;AgentID&quot;</span><span class="p">,</span> <span class="n">id</span><span class="p">())</span>
           <span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">time</span><span class="p">())</span>
           <span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;WaterUsage&quot;</span><span class="p">,</span> <span class="n">monthl_water</span><span class="p">)</span>
           <span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;OperatingCost&quot;</span><span class="p">,</span> <span class="n">monthly_op_cost</span><span class="p">)</span>
           <span class="o">-&gt;</span><span class="n">Record</span><span class="p">();</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This would create a table in the output database named &#8220;MyReactorData&#8221;. The
table would get a new row entry every time step with four columns named
&#8220;AgentID&#8221;, &#8220;Time&#8221;, &#8220;WaterUsage&#8221; and &#8220;OperatingCost&#8221;.  <tt class="docutils literal"><span class="pre">AddVal</span></tt> calls can be chained
any number of times for an arbitrary number of columns.  <tt class="docutils literal"><span class="pre">Record</span></tt> must be
called once for each datum after all values have been added.  Any custom
tables created in this manner will appear in the output database alongside the
<span style="font-variant:small-caps;">Cyclus</span> core tables.  Because there may be several agent instances of a
single agent class, tables should generally include a column that adds their
ID; and for similar reasons, it is often desirable to include the simulation
time as a column in these tables:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NewDatum</span><span class="p">(</span><span class="s">&quot;MyReactorData&quot;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;AgentID&quot;</span><span class="p">,</span> <span class="n">id</span><span class="p">())</span>
         <span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">time</span><span class="p">())</span>
         <span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(...</span>
         <span class="p">...</span>
</pre></div>
</div>
<p>Datums with the same table name must have the same schema (e.g. same field
names and value types). It is the responsibility of the developer to
enforce this in their code.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Database formats only support a finite number of datum value-types.  Do not
add values to database tables that are not supported by the backend(s) in
use. For information on which c++ types the backends support, you can check
<a class="reference internal" href="dbtypes.html"><em>here</em></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you require a datatype that isn&#8217;t currently supported, please
ask the kernel developers and they will help as soon as possible.</p>
</div>
<div class="section" id="table-data-shapes">
<h2>Table Data Shapes<a class="headerlink" href="#table-data-shapes" title="Permalink to this headline">¶</a></h2>
<p>All added values can optionally take a <cite>std::vector&lt;int&gt;*</cite> shape argument that
is used as maximum dimensions for the value being added.  The <a class="reference internal" href="dbtypes.html"><em>Database Types</em></a>
page lists the rank of the shape of different C++ types.  A
<tt class="docutils literal"><span class="pre">std::vector&lt;std::string&gt;</span></tt> has rank two - the first shape element being the
length of the vector, the second element being the length of each string in
the vector.  When the shape argument is ommitted, the default is to treat all
elements in the value as variable-length.  An entry of <cite>-1</cite> in the shape
vector indicates variable length also.  It is an error to pass in a shape
vector with the wrong rank (number of elements) for that type.  An example of
using the shape vector follows:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">colors</span><span class="p">;</span>
<span class="n">colors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;green&quot;</span><span class="p">);</span>
<span class="n">colors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">);</span>
<span class="n">colors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;chartreuse&quot;</span><span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">shape</span><span class="p">;</span> <span class="c1">// this should usually be a class member variable</span>
<span class="n">shape</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// maximum number of elements in the color vector</span>
<span class="n">shape</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span> <span class="c1">// maximum character length of each color</span>

<span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NewDatum</span><span class="p">(</span><span class="s">&quot;DecorPreferences&quot;</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;AgentID&quot;</span><span class="p">,</span> <span class="n">id</span><span class="p">())</span>
         <span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">time</span><span class="p">())</span>
         <span class="o">-&gt;</span><span class="n">AddVal</span><span class="p">(</span><span class="s">&quot;FavoritColors&quot;</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
         <span class="o">-&gt;</span><span class="n">Record</span><span class="p">();</span>
</pre></div>
</div>
<p>In the example above, the &#8220;chartreuse&#8221; color is longer than the 8 characters
specified in the shape.  So it will be truncated to &#8220;chartreu&#8221; in the
database. Shape vectors should generally be stored as class member variables
to avoid excessive memory [de]allocation and should be set correctly from
construction to destruction of your agent.</p>
</div>
<div class="section" id="reserved-table-names">
<h2>Reserved Table Names<a class="headerlink" href="#reserved-table-names" title="Permalink to this headline">¶</a></h2>
<p>The <span style="font-variant:small-caps;">Cyclus</span> kernel creates several of its own tables.  The names of these
tables are reserved, and you are responsible to avoid using them for custom
table names.  The reserved table names are (all case combos upper and lower):</p>
<ul>
<li><p class="first">all names starting with the prefixes:</p>
<blockquote>
<div><ul class="simple">
<li>Cyclus</li>
<li>Agent</li>
<li>VL_</li>
<li>Pair</li>
<li>String</li>
<li>Vector</li>
<li>Map</li>
<li>List</li>
<li>Set</li>
<li>Blob</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Resources</p>
</li>
<li><p class="first">Products</p>
</li>
<li><p class="first">Transactions</p>
</li>
<li><p class="first">Info</p>
</li>
<li><p class="first">Finish</p>
</li>
<li><p class="first">InputFiles</p>
</li>
<li><p class="first">Prototypes</p>
</li>
<li><p class="first">Recipes</p>
</li>
<li><p class="first">Snapshots</p>
</li>
<li><p class="first">MaterialInfo</p>
</li>
<li><p class="first">Compositions</p>
</li>
<li><p class="first">NextIds</p>
</li>
<li><p class="first">ResCreators</p>
</li>
<li><p class="first">CommodPriority</p>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Table names may only contain alphanumeric characters and underscores and
must not start with a number.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../index.html" title="index">
          <img class="logo" src="../_static/big_c.png" alt="Logo"/>
        </a></p><div class="sphinxlocaltoc">
    <h3><a href="../index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Custom Database Tables</a><ul>
<li><a class="reference internal" href="#table-data-shapes">Table Data Shapes</a></li>
<li><a class="reference internal" href="#reserved-table-names">Reserved Table Names</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="dbtypes.html"
                          title="Previous page">&larr; Database Types</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="errors.html"
                          title="Next page">&rarr; Errors and Warnings</a></p>
  </div>
  <div class="sphinxlocaltoc">
  <h3>Useful Pages</h3>
    <ul><li><ul>
    <li><a href="/user/index.html">User Guide</a></li>
    <li><a href="/arche/index.html">Archetype Developer Guide</a></li>
    <li><a href="http://fuelcycle.org/cyclus/api/">Cyclus API Documentation</a></li>
    <li><a href="http://fuelcycle.org/cycamore/api/">Cycamore API Documentation</a></li>
    <li><a href="/basics/glossary.html">Glossary</a></li>
    <li><a href="mailto:cyclus-users+subscribe@googlegroups.com?subject=Subscribe&body=Send this message to subscribe to the list">Join</a> the 
      <a href="https://groups.google.com/forum/#!forum/cyclus-users" target="_blank"><span style="font-variant:small-caps">Cyclus</span> Users</a> mailing list.
    <li><a href="mailto:cyclus-dev+subscribe@googlegroups.com?subject=Subscribe&body=Send this message to subscribe to the list">Join</a> the 
      <a href="https://groups.google.com/forum/#!forum/cyclus-users" target="_blank"><span style="font-variant:small-caps">Cyclus</span> Developers</a> mailing list.
    </ul></li></ul>
  </div>
    
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <h3>Get Cyclus</h3>
    <br>
    Current version: <b>1.2.0</b>
    <br><br>
    Install:
    <div class="highlight-bash" style="width:97.5%"><div class="highlight"><pre><span class="nv">$ </span>conda install cyclus cycamore</pre></div></div>
    Get the Source:
    <ul><li><ul>
          <li><a href="https://github.com/cyclus/cyclus">Cyclus</a></li>
          <li><a href="https://github.com/cyclus/cycamore">Cycamore</a></li>
    </ul></li></ul>
    <h3>Acknowledgements</h3>
    The Cyclus project has received support from:
    <br />
    <a href="http://www.neup.gov" target="_blank"><img src="../_static/neup_logo_large.png" width=170px></a>
    <br />
    <br />

    In addition, some of the students working on Cyclus have received support from:
    <br />
    <a href="http://www.anl.gov" target="_blank"><img src="../_static/AnlLogo.png" height=100px></a>
    <a href="http://www.nrc.gov" target="_blank"><img src="../_static/USNRC.png" height=100px></a>
    <br />
    <a href="http://www.neup.gov" target="_blank"><img src="../_static/neup_logo_large.png" width=170px></a>
    <br />
    <a href="http://www.nsf.gov" target="_blank"><img src="../_static/nsf_logo.png" height=100px></a>
    <a href="http://www.wisc.edu" target="_blank"><img src="../_static/crest.png" height=100px></a>

    

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="errors.html" title="Errors and Warnings"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="dbtypes.html" title="Database Types"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &raquo;</li>

          <li><a href="index.html" ><span style="font-variant:small-caps;">Cyclus</span> Archetype Developer Guide</a> &raquo;</li> 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2012-2014, University of Wisconsin Computational Nuclear Engineering Research Group.
      Last updated on May 05, 2015.
    </div><script type="text/javascript">
    if(ga_enabled){
        document.write("<div class=\"footer\">This page uses <a href=\"http://analytics.google.com\">Google Analytics</a> to collect statistics. ");
        document.write("Click <button title=\"set cookie to disable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', 'true', {expires: 3650, path: '/'}); window.location.reload(); return false; \">here</button> to disable analytics for this site.");
        document.write("</div>");
    }else{
        document.write("<div class=\"footer\">Google Analytics has been disabled. ");
        document.write("Click <button title=\"set cookie to re-enable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', null, {path: '/'}); window.location.reload(); return false; \">here</button> to re-enable analytics for this site.");
    };
</script>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>