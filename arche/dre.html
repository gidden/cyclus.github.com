

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Dynamic Resource Exchange &mdash; Home</title>
    
    <link rel="stylesheet" href="../_static/cyclus.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'b&#39;(1.2.0-169-gb799c02)&#39;',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/cloud.js"></script>
    <link rel="shortcut icon" href="../_static/big_c.ico"/>
    <link rel="top" title="Home" href="../index.html" />
    <link rel="up" title="Cyclus Archetype Developer Guide" href="index.html" />
    <link rel="next" title="Database Types" href="dbtypes.html" />
    <link rel="prev" title="Resources" href="resources.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1"><script type="text/javascript">
var ga_enabled = !$.cookie('disable-ga');
if(ga_enabled){
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12222727-2']);
  _gaq.push(['_setCookiePath', '/']);
  _gaq.push(['_setDetectFlash', false]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}
</script>
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="dbtypes.html" title="Database Types"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="resources.html" title="Resources"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &raquo;</li>

          <li><a href="index.html" accesskey="U"><span style="font-variant:small-caps;">Cyclus</span> Archetype Developer Guide</a> &raquo;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="dynamic-resource-exchange">
<span id="dre"></span><h1>Dynamic Resource Exchange<a class="headerlink" href="#dynamic-resource-exchange" title="Permalink to this headline">¶</a></h1>
<p>The Dynamic Resource Exchange (DRE) is the heart of a <span style="font-variant:small-caps;">Cyclus</span> simulation time
step. Every <tt class="docutils literal"><span class="pre">cyclus::Trader</span></tt> that is registered with the <tt class="docutils literal"><span class="pre">cyclus::Context</span></tt>
are automatically included in the exchange. <span style="font-variant:small-caps;">Cyclus</span> agents can either implement
the <tt class="docutils literal"><span class="pre">cyclus::Trader</span></tt> interface as a mixin or can be composed of one or more
<tt class="docutils literal"><span class="pre">cyclus::Trader</span></tt>s. Note that <tt class="docutils literal"><span class="pre">cyclus::Facility</span></tt> derives the
<tt class="docutils literal"><span class="pre">cyclus::Trader</span></tt> interface, therefore all agents that derive from
<tt class="docutils literal"><span class="pre">cyclus::Facility</span></tt> also get the interface.</p>
<p>At any given time step, there is a separate <tt class="docutils literal"><span class="pre">cyclus::ResourceExchange</span></tt>
instance for each concrete <tt class="docutils literal"><span class="pre">cyclus::Resource</span></tt> of which the kernel is
aware. For example, there is an exchange for <tt class="docutils literal"><span class="pre">cyclus::Material</span></tt>s and another
for <tt class="docutils literal"><span class="pre">cyclus::Product</span></tt>s.</p>
<p>The DRE is comprised of five phases:</p>
<ul class="simple">
<li><a class="reference internal" href="#rfb"><em>Request For Bids Phase</em></a></li>
<li><a class="reference internal" href="#rrfb"><em>Response to Request For Bids Phase</em></a></li>
<li><a class="reference internal" href="#adj"><em>Preference Adjustment Phase</em></a></li>
<li><a class="reference internal" href="#solve"><em>Solution Phase</em></a></li>
<li><a class="reference internal" href="#trade"><em>Trade Execution Phase</em></a></li>
<li><a class="reference internal" href="#examples"><em>Examples</em></a></li>
</ul>
<div class="section" id="request-for-bids-phase">
<span id="rfb"></span><h2>Request For Bids Phase<a class="headerlink" href="#request-for-bids-phase" title="Permalink to this headline">¶</a></h2>
<p>In the Request for Bids (RFB) phase, the exchange queries all registered traders
regarding their demand for a given resource type. Querying is provided through
the <tt class="docutils literal"><span class="pre">cyclus::Trader</span></tt> interface&#8217;s <tt class="docutils literal"><span class="pre">Get*Requests</span></tt> for a given resource type,
e.g., <tt class="docutils literal"><span class="pre">GetMatlRequests</span></tt>.</p>
<p>Requests are modeled as collections of <tt class="docutils literal"><span class="pre">cyclus::RequestPortfolio</span></tt>s, where each
portfolio includes a collection of <tt class="docutils literal"><span class="pre">cyclus::Request</span></tt>s and a collection of
<tt class="docutils literal"><span class="pre">cyclus::CapacityConstraint</span></tt>s. A portfolio is sufficiently met if one or more
of its constituent requests are met and all of its constraints are satisfied.</p>
<p>A request provides a target resource, a commodity, and a preference for that
commodity-resource combination. A constraint provides a constraining value and a
conversion function that can convert a potential resource into the units of the
capacity (see <a class="reference internal" href="#rrfb"><em>Response to Request For Bids Phase</em></a> for a more detailed example).</p>
<p>For example, consider a facility of type <tt class="docutils literal"><span class="pre">FooFac</span></tt> that needs 5 kg fuel,
which is a <tt class="docutils literal"><span class="pre">cyclus::Material</span></tt> resource type. It knows of two commodities in
the simulation that meet its demand, <tt class="docutils literal"><span class="pre">FuelA</span></tt> and <tt class="docutils literal"><span class="pre">FuelB</span></tt>, and it prefers
<tt class="docutils literal"><span class="pre">FuelA</span></tt> over <tt class="docutils literal"><span class="pre">FuelB</span></tt>. A valid <tt class="docutils literal"><span class="pre">GetMatlRequests</span></tt> implementation would then
be:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">RequestPortfolio</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span><span class="o">&gt;</span>
    <span class="n">FooFac</span><span class="o">::</span><span class="n">GetMatlRequests</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">RequestPortfolio</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">CapacityConstraint</span><span class="p">;</span>

  <span class="kt">double</span> <span class="n">request_qty</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// kg</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">recipeA</span> <span class="o">=</span> <span class="s">&quot;recipeA&quot;</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">commoda</span> <span class="o">=</span> <span class="s">&quot;FuelA&quot;</span><span class="p">;</span>
  <span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">targetA</span> <span class="o">=</span>
      <span class="n">Material</span><span class="o">::</span><span class="n">CreateUntracked</span><span class="p">(</span><span class="n">request_qty</span><span class="p">,</span> <span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetRecipe</span><span class="p">(</span><span class="n">recipeA</span><span class="p">));</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">recipeB</span> <span class="o">=</span> <span class="s">&quot;recipeB&quot;</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">commodB</span> <span class="o">=</span> <span class="s">&quot;FuelB&quot;</span><span class="p">;</span>
  <span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">targetB</span> <span class="o">=</span>
      <span class="n">Material</span><span class="o">::</span><span class="n">CreateUntracked</span><span class="p">(</span><span class="n">request_qty</span><span class="p">,</span> <span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetRecipe</span><span class="p">(</span><span class="n">recipeB</span><span class="p">));</span>

  <span class="n">CapacityConstraint</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;</span> <span class="n">cc</span><span class="p">(</span><span class="n">request_qty</span><span class="p">);</span>

  <span class="n">RequestPortfolio</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span> <span class="n">port</span><span class="p">(</span><span class="k">new</span> <span class="n">RequestPortfolio</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;</span><span class="p">());</span>
  <span class="n">port</span><span class="o">-&gt;</span><span class="n">AddRequest</span><span class="p">(</span><span class="n">targeta</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="n">commodA</span><span class="p">);</span>
  <span class="n">port</span><span class="o">-&gt;</span><span class="n">AddRequest</span><span class="p">(</span><span class="n">targetb</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="n">commodB</span><span class="p">);</span>
  <span class="n">port</span><span class="o">-&gt;</span><span class="n">AddConstraint</span><span class="p">(</span><span class="n">cc</span><span class="p">);</span>

  <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">RequestPortfolio</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span><span class="o">&gt;</span> <span class="n">ports</span><span class="p">();</span>
  <span class="n">ports</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">ports</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="response-to-request-for-bids-phase">
<span id="rrfb"></span><h2>Response to Request For Bids Phase<a class="headerlink" href="#response-to-request-for-bids-phase" title="Permalink to this headline">¶</a></h2>
<p>In the Response to Request for Bids (RRFB) phase, the exchange queries all
registered traders regarding their supply for a given resource type. Querying is
provided through the <tt class="docutils literal"><span class="pre">cyclus::Trader</span></tt> interface&#8217;s <tt class="docutils literal"><span class="pre">Get*Bids</span></tt> for a given
resource type, e.g., <tt class="docutils literal"><span class="pre">GetMatlBids</span></tt>.</p>
<p>Bids are modeled as collections of <tt class="docutils literal"><span class="pre">cyclus::BidPortfolio</span></tt>s, where each
portfolio includes a collection of <tt class="docutils literal"><span class="pre">cyclus::Bid</span></tt>s and a collection of
<tt class="docutils literal"><span class="pre">cyclus::CapacityConstraint</span></tt>s. A portfolio is not violated if any of its
constituent bids are connected to their requests and all of its constraints are
satisfied.</p>
<p>A bid is comprised of a request to which it is responding and a resource that it is
offering in response to the request.</p>
<div class="section" id="black-box-examples">
<h3>Black Box Examples<a class="headerlink" href="#black-box-examples" title="Permalink to this headline">¶</a></h3>
<p>Consider a facility of type <tt class="docutils literal"><span class="pre">FooFac</span></tt> that has 10 kg of fuel of commodity type
<tt class="docutils literal"><span class="pre">FuelA</span></tt> that it can provide. Furthermore, consider that its capacity to
fulfill orders is constrained by the total amount of a given nuclide. A valid
<tt class="docutils literal"><span class="pre">GetMatlBids</span></tt> implementation would then be:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NucConverter</span> <span class="o">:</span> <span class="k">public</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Converter</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">NucConverter</span><span class="p">(</span><span class="kt">int</span> <span class="n">nuc</span><span class="p">)</span> <span class="o">:</span> <span class="n">nuc_</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span> <span class="p">{};</span>

  <span class="k">virtual</span> <span class="kt">double</span> <span class="nf">convert</span><span class="p">(</span>
      <span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">m</span><span class="p">,</span>
      <span class="n">cyclus</span><span class="o">::</span><span class="n">Arc</span> <span class="k">const</span> <span class="o">*</span> <span class="n">a</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
      <span class="n">cyclus</span><span class="o">::</span><span class="n">ExchangeTranslationContext</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;</span> <span class="k">const</span> <span class="o">*</span> <span class="n">ctx</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">cyclus</span><span class="o">::</span><span class="n">MatQuery</span> <span class="n">mq</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">mq</span><span class="p">.</span><span class="n">mass</span><span class="p">(</span><span class="n">nuc_</span><span class="p">);</span>
  <span class="p">}</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">nuc_</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">BidPortfolio</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span><span class="o">&gt;</span>
  <span class="n">FooFac</span><span class="o">::</span><span class="n">GetMatlBids</span><span class="p">(</span>
    <span class="n">cyclus</span><span class="o">::</span><span class="n">CommodMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&amp;</span> <span class="n">commod_requests</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">BidPortfolio</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">CapacityConstraint</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Converter</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Request</span><span class="p">;</span>

  <span class="c1">// respond to all requests of my commodity</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">my_commodity</span> <span class="o">=</span> <span class="s">&quot;FuelA&quot;</span><span class="p">;</span>
  <span class="n">BidPortfolio</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span> <span class="n">port</span><span class="p">(</span><span class="k">new</span> <span class="n">BidPortfolio</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;</span><span class="p">());</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Request</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*&gt;&amp;</span> <span class="n">requests</span> <span class="o">=</span> <span class="n">commod_requests</span><span class="p">[</span><span class="n">my_commdoity</span><span class="p">];</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Request</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*&gt;::</span><span class="n">iterator</span> <span class="n">it</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">it</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">requests</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">recipe</span> <span class="o">=</span> <span class="s">&quot;recipe&quot;</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">commod</span> <span class="o">=</span> <span class="s">&quot;Fuel&quot;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">it</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">requests</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">offer</span> <span class="o">=</span>
          <span class="n">Material</span><span class="o">::</span><span class="n">CreateUntracked</span><span class="p">(</span><span class="n">request_qty</span><span class="p">,</span> <span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetRecipe</span><span class="p">(</span><span class="n">recipe</span><span class="p">));</span>
    <span class="n">port</span><span class="o">-&gt;</span><span class="n">AddBid</span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">,</span> <span class="n">offer</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// add a custom constraint for Pu-239</span>
  <span class="kt">int</span> <span class="n">pu</span> <span class="o">=</span> <span class="mi">932390000</span><span class="p">;</span> <span class="c1">// Pu-239</span>
  <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span> <span class="n">conv</span><span class="p">(</span><span class="k">new</span> <span class="n">NucConverter</span><span class="p">(</span><span class="n">pu</span><span class="p">));</span>
  <span class="kt">double</span> <span class="n">max_pu</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">;</span> <span class="c1">// 1 Signifigant Quantity of Pu-239</span>
  <span class="n">CapacityConstraint</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;</span> <span class="n">constr</span><span class="p">(</span><span class="n">max_pu</span><span class="p">,</span> <span class="n">conv</span><span class="p">);</span>
  <span class="n">port</span><span class="o">-&gt;</span><span class="n">AddConstraint</span><span class="p">(</span><span class="n">constr</span><span class="p">);</span>

  <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">BidPortfolio</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span><span class="o">&gt;</span> <span class="n">ports</span><span class="p">;</span>
  <span class="n">ports</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">ports</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="white-box-examples">
<h3>White Box Examples<a class="headerlink" href="#white-box-examples" title="Permalink to this headline">¶</a></h3>
<p>Consider a case where a facility&#8217;s bid depends on the type of the requester&#8217;s
<tt class="docutils literal"><span class="pre">cyclus::Agent</span></tt>, and the bidder determines its offer based on the requester&#8217;s
interface:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">FooFac</span><span class="o">::</span><span class="n">SpecialFooOffer</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">recipe</span> <span class="o">=</span> <span class="s">&quot;recipe&quot;</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">target</span> <span class="o">=</span>
      <span class="n">Material</span><span class="o">::</span><span class="n">CreateUntracked</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetRecipe</span><span class="p">(</span><span class="n">recipe</span><span class="p">));</span>
  <span class="k">return</span> <span class="n">target</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">BidPortfolio</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span><span class="o">&gt;</span>
  <span class="n">FooFac</span><span class="o">::</span><span class="n">GetMatlBids</span><span class="p">(</span>
    <span class="n">cyclus</span><span class="o">::</span><span class="n">CommodMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&amp;</span> <span class="n">commod_requests</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">BidPortfolio</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Request</span><span class="p">;</span>

  <span class="c1">// respond to all requests of my commodity</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">my_commodity</span> <span class="o">=</span> <span class="s">&quot;FuelA&quot;</span><span class="p">;</span>
  <span class="n">BidPortfolio</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span> <span class="n">port</span><span class="p">(</span><span class="k">new</span> <span class="n">BidPortfolio</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;</span><span class="p">());</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Request</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*&gt;&amp;</span> <span class="n">requests</span> <span class="o">=</span> <span class="n">commod_requests</span><span class="p">[</span><span class="n">my_commdoity</span><span class="p">];</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Request</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*&gt;::</span><span class="n">iterator</span> <span class="n">it</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">it</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">requests</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">offer</span><span class="p">;</span>
    <span class="n">Agent</span><span class="o">*</span> <span class="n">agent</span> <span class="o">=</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">requester</span><span class="p">();</span>
    <span class="n">FooFac</span><span class="o">*</span> <span class="n">cast</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">FooFac</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">agent</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cast</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">offer</span> <span class="o">=</span> <span class="n">cast</span><span class="o">-&gt;</span><span class="n">SpecialFooOffer</span><span class="p">();</span> <span class="c1">// get a special response that the requester wants</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">qty</span> <span class="o">=</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">quantity</span><span class="p">();</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">recipe</span> <span class="o">=</span> <span class="s">&quot;some_other_recipe&quot;</span><span class="p">;</span>
        <span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">offer</span> <span class="o">=</span> <span class="n">Material</span><span class="o">::</span><span class="n">CreateUntracked</span><span class="p">(</span><span class="n">qty</span><span class="p">,</span> <span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetRecipe</span><span class="p">(</span><span class="n">recipe</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">port</span><span class="o">-&gt;</span><span class="n">AddBid</span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">,</span> <span class="n">offer</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">BidPortfolio</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span><span class="o">&gt;</span> <span class="n">ports</span><span class="p">;</span>
  <span class="n">ports</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">ports</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="preference-adjustment-phase">
<span id="adj"></span><h2>Preference Adjustment Phase<a class="headerlink" href="#preference-adjustment-phase" title="Permalink to this headline">¶</a></h2>
<p>In the Preference Adjustment (PA) phase, requesters are allowed to view which
bids were matched to their requests, and adjust their preference for the given
bid-request pairing. Querying is provided through the <tt class="docutils literal"><span class="pre">cyclus::Trader</span></tt> and
<tt class="docutils literal"><span class="pre">cyclus::Agent</span></tt> interfaces&#8217; <tt class="docutils literal"><span class="pre">Adjust*Prefs</span></tt> for a given resource type, e.g.,
<tt class="docutils literal"><span class="pre">AdjustMaterialPrefs</span></tt>.</p>
<p>Preferences are used by resource exchange solvers to inform their solution
method. The default preference for all bids is zero. Agents will only utilize
the PA phase if there is a reason to update preferences over the default
provided in their original request.</p>
<p>Preferences can be adjusted by both the original <tt class="docutils literal"><span class="pre">cyclus::Trader</span></tt> placing
requests as well as any parent <tt class="docutils literal"><span class="pre">cyclus::Agent</span></tt>s, with the trader adjusting
first and the most senior parent adjusting last. In the supported
Region-Institution-Facility agent relationship, Facilities adjust first,
followed by Institution and Region parent agents. The calling chain is shown in
Figure 1, with the orange box representing a call through the <tt class="docutils literal"><span class="pre">cyclus::Trader</span></tt>
interface and a green box representing the <tt class="docutils literal"><span class="pre">cyclus::Agent</span></tt> interface.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/dre-1.svg"><img height="500" src="../_images/dre-1.svg" /></a>
<p class="caption"><strong>Figure 1:</strong> R-I-F Preference Adjustment Call Chain</p>
</div>
<div class="section" id="id1">
<h3>Black Box Examples<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>For example, suppose that an agent prefers potential trades in which the bidder
has the same parent agent as it does. A valid <tt class="docutils literal"><span class="pre">AdjustMatlPrefs</span></tt> implementation
would then be:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">virtual</span> <span class="kt">void</span> <span class="n">FooFac</span><span class="o">::</span><span class="n">AdjustMatlPrefs</span><span class="p">(</span>
    <span class="n">cyclus</span><span class="o">::</span><span class="n">PrefMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&amp;</span> <span class="n">prefs</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cyclus</span><span class="o">::</span><span class="n">PrefMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">::</span><span class="n">iterator</span> <span class="n">pmit</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">pmit</span> <span class="o">=</span> <span class="n">prefs</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">pmit</span> <span class="o">!=</span> <span class="n">prefs</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">pmit</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">Bid</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">mit</span><span class="p">;</span>
    <span class="n">Request</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span> <span class="n">req</span> <span class="o">=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">mit</span> <span class="o">=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">mit</span> <span class="o">!=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">mit</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Bid</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span> <span class="n">bid</span> <span class="o">=</span> <span class="n">mit</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">parent</span><span class="p">()</span> <span class="o">==</span> <span class="n">bid</span><span class="o">-&gt;</span><span class="n">bidder</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">manager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">())</span>
        <span class="n">mit</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// bump pref if parents are equal</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Alternatively, a <tt class="docutils literal"><span class="pre">cyclus::Institution</span></tt> managing a <tt class="docutils literal"><span class="pre">cyclus::Facility</span></tt> could
adjust preferences as follows</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">virtual</span> <span class="kt">void</span> <span class="n">FooInst</span><span class="o">::</span><span class="n">AdjustMatlPrefs</span><span class="p">(</span>
    <span class="n">cyclus</span><span class="o">::</span><span class="n">PrefMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&amp;</span> <span class="n">prefs</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cyclus</span><span class="o">::</span><span class="n">PrefMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">::</span><span class="n">iterator</span> <span class="n">pmit</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">pmit</span> <span class="o">=</span> <span class="n">prefs</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">pmit</span> <span class="o">!=</span> <span class="n">prefs</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">pmit</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">Bid</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">mit</span><span class="p">;</span>
    <span class="n">Request</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span> <span class="n">req</span> <span class="o">=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">mit</span> <span class="o">=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">mit</span> <span class="o">!=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">mit</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Bid</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span> <span class="n">bid</span> <span class="o">=</span> <span class="n">mit</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
      <span class="n">Agent</span><span class="o">*</span> <span class="n">you</span> <span class="o">=</span> <span class="n">bid</span><span class="o">-&gt;</span><span class="n">bidder</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">manager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">();</span>
      <span class="n">Agent</span><span class="o">*</span> <span class="n">me</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">me</span> <span class="o">==</span> <span class="n">you</span><span class="p">)</span>
        <span class="n">mit</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// bump pref if the parent is me (institutions are equal)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, a <tt class="docutils literal"><span class="pre">cyclus::Region</span></tt> managing a <tt class="docutils literal"><span class="pre">cyclus::Institution</span></tt> could adjust
preferences as</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">virtual</span> <span class="kt">void</span> <span class="n">FooRegion</span><span class="o">::</span><span class="n">AdjustMatlPrefs</span><span class="p">(</span>
    <span class="n">cyclus</span><span class="o">::</span><span class="n">PrefMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&amp;</span> <span class="n">prefs</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cyclus</span><span class="o">::</span><span class="n">PrefMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">::</span><span class="n">iterator</span> <span class="n">pmit</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">pmit</span> <span class="o">=</span> <span class="n">prefs</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">pmit</span> <span class="o">!=</span> <span class="n">prefs</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">pmit</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">Bid</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">mit</span><span class="p">;</span>
    <span class="n">Request</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span> <span class="n">req</span> <span class="o">=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">mit</span> <span class="o">=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">mit</span> <span class="o">!=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">mit</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Bid</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span> <span class="n">bid</span> <span class="o">=</span> <span class="n">mit</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
      <span class="n">Agent</span><span class="o">*</span> <span class="n">you</span> <span class="o">=</span> <span class="n">bid</span><span class="o">-&gt;</span><span class="n">bidder</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">manager</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">();</span>
      <span class="n">Agent</span><span class="o">*</span> <span class="n">me</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">me</span> <span class="o">==</span> <span class="n">you</span><span class="p">)</span>
        <span class="n">mit</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// bump pref if the grandparent is me (regions are equal)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>White Box Examples<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Consider a scenario in which preferences will only be adjusted if the requester
and bidder are of the same type:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">virtual</span> <span class="kt">void</span> <span class="n">FooFac</span><span class="o">::</span><span class="n">AdjustMatlPrefs</span><span class="p">(</span>
    <span class="n">cyclus</span><span class="o">::</span><span class="n">PrefMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&amp;</span> <span class="n">prefs</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cyclus</span><span class="o">::</span><span class="n">PrefMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">::</span><span class="n">iterator</span> <span class="n">pmit</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">pmit</span> <span class="o">=</span> <span class="n">prefs</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">pmit</span> <span class="o">!=</span> <span class="n">prefs</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">pmit</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Request</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span> <span class="n">req</span> <span class="o">=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
    <span class="n">FooFac</span><span class="o">*</span> <span class="n">cast</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">FooFac</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">requester</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">manager</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cast</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">mit</span> <span class="o">=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">mit</span> <span class="o">!=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">mit</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">mit</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">=</span> <span class="n">pref</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// we like this guy!</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="solution-phase">
<span id="solve"></span><h2>Solution Phase<a class="headerlink" href="#solution-phase" title="Permalink to this headline">¶</a></h2>
<p>The Solution Phase is straightforward from a module developer point of
view. Given requests, bids for those requests, and preferences for each
request-bid pairing, a <tt class="docutils literal"><span class="pre">cyclus::ExchangeSolver</span></tt> selects request-bid pairs to
satisfy and the quantity each resource to assign to each satisfied request-bid
pairing. The solution times and actual pairings will depend on the concrete
solver that is employed by the <span style="font-variant:small-caps;">Cyclus</span> kernel. At present, only the
<tt class="docutils literal"><span class="pre">cyclus::GreedySolver</span></tt> is available.</p>
</div>
<div class="section" id="trade-execution-phase">
<span id="trade"></span><h2>Trade Execution Phase<a class="headerlink" href="#trade-execution-phase" title="Permalink to this headline">¶</a></h2>
<p>When satisfactory request-bid pairings are determined, a final communication is
executed for each bidder and requester during the Trade Execution Phase. Bidders
are notified of their winning bids through the <tt class="docutils literal"><span class="pre">cyclus::Trader</span></tt> <tt class="docutils literal"><span class="pre">Get*Trades</span></tt>
member function (e.g. <tt class="docutils literal"><span class="pre">GetMatlTrades</span></tt>), and requesters are provided their
satisfied requests through the <tt class="docutils literal"><span class="pre">cyclus::Trader</span></tt> <tt class="docutils literal"><span class="pre">Accept*Trades</span></tt> member
function (e.g. <tt class="docutils literal"><span class="pre">AcceptMatlTrades</span></tt>).</p>
<p>Traders can implement a <tt class="docutils literal"><span class="pre">TradeResponse</span></tt> function that provides a
<tt class="docutils literal"><span class="pre">cyclus::Material::Ptr</span></tt> given a <tt class="docutils literal"><span class="pre">cyclus::Trade</span></tt>. It can then implement its
Trader interface as follows:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="kt">void</span> <span class="n">FooFac</span><span class="o">::</span><span class="n">GetMatlTrades</span><span class="p">(</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Trade</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;</span> <span class="o">&gt;&amp;</span> <span class="n">trades</span><span class="p">,</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Trade</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&gt;</span> <span class="o">&gt;&amp;</span> <span class="n">responses</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Trade</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">Trade</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;</span> <span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">it</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">it</span> <span class="o">=</span> <span class="n">trades</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">trades</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">mat</span> <span class="o">=</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">bid</span><span class="o">-&gt;</span><span class="n">offer</span><span class="p">();</span>
    <span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">response</span> <span class="o">=</span> <span class="n">TradeResponse</span><span class="p">(</span><span class="n">mat</span><span class="p">);</span>
    <span class="n">responses</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">,</span> <span class="n">response</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Similarly, Traders can implement an <tt class="docutils literal"><span class="pre">AcceptTrade</span></tt> function that accepts a
<tt class="docutils literal"><span class="pre">cyclus::Material::Ptr</span></tt> given a <tt class="docutils literal"><span class="pre">cyclus::Trade</span></tt>. It can then implement its
Trader interface as follows:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="kt">void</span> <span class="n">FooFac</span><span class="o">::</span><span class="n">AcceptMatlTrades</span><span class="p">(</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Trade</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&gt;</span> <span class="o">&gt;&amp;</span> <span class="n">responses</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Trade</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;</span><span class="p">,</span>
      <span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&gt;</span> <span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">it</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">it</span> <span class="o">=</span> <span class="n">responses</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">responses</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">AcceptTrade</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The implementation logic for each of these functions is determined by how each
individual agent handles their resource inventories. Accordingly, their
implementation will be unique to each agent. Some initial examples can be found
in the <tt class="docutils literal"><span class="pre">cyclus::Source</span></tt> and <tt class="docutils literal"><span class="pre">cyclus::Sink</span></tt> agents, where <tt class="docutils literal"><span class="pre">cyclus::Source</span></tt>
implements <tt class="docutils literal"><span class="pre">GetMatlTrades</span></tt> as a bidder and <tt class="docutils literal"><span class="pre">cyclus::Sink</span></tt> implements
<tt class="docutils literal"><span class="pre">AcceptMatlTrades</span></tt> as a requester.</p>
</div>
<div class="section" id="examples">
<span id="id3"></span><h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mixin-based-trader-behavior">
<h3>Mixin-based Trader Behavior<a class="headerlink" href="#mixin-based-trader-behavior" title="Permalink to this headline">¶</a></h3>
<p>Trader behavior can be specialized based on mixins that an archetype uses. For
example, consider an interface that helps determines preferences based on
the equality of the parent of a <tt class="docutils literal"><span class="pre">cyclus::Agent</span></tt>.</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PrefGetter</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">double</span> <span class="n">GetPref</span><span class="p">(</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Agent</span><span class="o">*</span> <span class="n">mine</span><span class="p">,</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Agent</span><span class="o">*</span> <span class="n">yours</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="p">(</span><span class="n">mine</span> <span class="o">==</span> <span class="n">yours</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mf">0.5</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>A trader who then wants behavior based on whether a bidder&#8217;s manager inherits
from <tt class="docutils literal"><span class="pre">PrefGetter</span></tt> can then implement its preference adjustment as follows:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">virtual</span> <span class="kt">void</span> <span class="n">FooFac</span><span class="o">::</span><span class="n">AdjustMatlPrefs</span><span class="p">(</span>
    <span class="n">cyclus</span><span class="o">::</span><span class="n">PrefMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&amp;</span> <span class="n">prefs</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">cyclus</span><span class="o">::</span><span class="n">PrefMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">::</span><span class="n">iterator</span> <span class="n">pmit</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">pmit</span> <span class="o">=</span> <span class="n">prefs</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">pmit</span> <span class="o">!=</span> <span class="n">prefs</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">pmit</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">Bid</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">mit</span><span class="p">;</span>
    <span class="n">Request</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span> <span class="n">req</span> <span class="o">=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
    <span class="n">cyclus</span><span class="o">::</span><span class="n">Agent</span><span class="o">*</span> <span class="n">reqagent</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">requester</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">manager</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">mit</span> <span class="o">=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">mit</span> <span class="o">!=</span> <span class="n">pmit</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">mit</span><span class="p">)</span> <span class="p">{</span>

      <span class="n">Bid</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*</span> <span class="n">bid</span> <span class="o">=</span> <span class="n">mit</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
      <span class="n">cyclus</span><span class="o">::</span><span class="n">Agent</span><span class="o">*</span> <span class="n">bidagent</span> <span class="o">=</span> <span class="n">bid</span><span class="o">-&gt;</span><span class="n">bidder</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">manager</span><span class="p">();</span>
      <span class="n">PrefGetter</span><span class="o">*</span> <span class="n">pg_cast</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">PrefGetter</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">bidagent</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">pg_cast</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// special behavior for the mixin</span>
        <span class="n">mit</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">=</span> <span class="n">cast</span><span class="o">-&gt;</span><span class="n">GetPref</span><span class="p">(</span><span class="n">reqagent</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">(),</span>
                                    <span class="n">bidagent</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">());</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">mit</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// choose any (reasonable) default behavior</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Using a dynamic-checking approach will limit the interoperability of your
archetype with others. Some mixins are provided by the <span style="font-variant:small-caps;">Cyclus</span> kernel in its
<a class="reference internal" href="toolkit.html#toolkit"><em>toolkit</em></a>, which is part of the core library.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Using a mixin-based approach will require special implementation of restart
related functions <em>if</em> the mixin has state associated with it (i.e., members
that are initialized from an input file and/or stored from timestep to
timestep). For further reading, see the <tt class="docutils literal"><span class="pre">pragma</span> <span class="pre">cyclus</span> <span class="pre">impl</span></tt> directive in
<a class="reference internal" href="cycpp.html#cycpp"><em>Using the Cyclus Preprocessor</em></a>.</p>
</div>
</div>
<div class="section" id="non-black-box-behavior">
<span id="white-box"></span><h3>Non-Black Box Behavior<a class="headerlink" href="#non-black-box-behavior" title="Permalink to this headline">¶</a></h3>
<p>Cyclus provides a simulation framework that supports black-box entity
interaction, i.e., any entity in the simulation can interact with any other
entity through its <tt class="docutils literal"><span class="pre">cyclus::Agent</span></tt> interface. However, there is nothing
stopping an archetype developer from implementing logic that is specific to a
implemented archetype.</p>
<p>For example, take a facility that informs a trader what composition of material
it wants given another facility&#8217;s inventory.</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TradeInformer</span><span class="o">:</span> <span class="k">public</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Facility</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="cp">#pragma cyclus</span>

  <span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">IdealMatl</span><span class="p">(</span><span class="k">const</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">toolkit</span><span class="o">::</span><span class="n">ResBuf</span><span class="o">&amp;</span> <span class="n">buffer</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// provide whatever implementation is desired</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>A provider of material can then implement its <tt class="docutils literal"><span class="pre">GetMatlBids</span></tt> as follows:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">BidPortfolio</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span><span class="o">&gt;</span>
  <span class="n">FooFac</span><span class="o">::</span><span class="n">GetMatlBids</span><span class="p">(</span>
    <span class="n">cyclus</span><span class="o">::</span><span class="n">CommodMap</span><span class="o">&lt;</span><span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&amp;</span> <span class="n">commod_requests</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">BidPortfolio</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Material</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Request</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">cyclus</span><span class="o">::</span><span class="n">Agent</span><span class="p">;</span>

  <span class="c1">// respond to all requests of my commodity</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">my_commodity</span> <span class="o">=</span> <span class="s">&quot;FuelA&quot;</span><span class="p">;</span>
  <span class="n">BidPortfolio</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span> <span class="n">port</span><span class="p">(</span><span class="k">new</span> <span class="n">BidPortfolio</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;</span><span class="p">());</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Request</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*&gt;&amp;</span> <span class="n">requests</span> <span class="o">=</span> <span class="n">commod_requests</span><span class="p">[</span><span class="n">my_commodity</span><span class="p">];</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Request</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;*&gt;::</span><span class="n">iterator</span> <span class="n">it</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">it</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">requests</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">offer</span><span class="p">;</span>
    <span class="n">Agent</span><span class="o">*</span> <span class="n">agent</span> <span class="o">=</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">requester</span><span class="p">();</span>
    <span class="n">TradeInformer</span><span class="o">*</span> <span class="n">cast</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">TradeInformer</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">agent</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cast</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">offer</span> <span class="o">=</span> <span class="n">cast</span><span class="o">-&gt;</span><span class="n">IdealMatl</span><span class="p">(</span><span class="n">inventory</span><span class="p">);</span> <span class="c1">// inventory is a state variable ResBuf</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">qty</span> <span class="o">=</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">quantity</span><span class="p">();</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">recipe</span> <span class="o">=</span> <span class="s">&quot;recipe&quot;</span><span class="p">;</span>
        <span class="n">Material</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">offer</span> <span class="o">=</span> <span class="n">Material</span><span class="o">::</span><span class="n">CreateUntracked</span><span class="p">(</span><span class="n">qty</span><span class="p">,</span> <span class="n">context</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetRecipe</span><span class="p">(</span><span class="n">recipe</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">port</span><span class="o">-&gt;</span><span class="n">AddBid</span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">,</span> <span class="n">offer</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">BidPortfolio</span><span class="o">&lt;</span><span class="n">Material</span><span class="o">&gt;::</span><span class="n">Ptr</span><span class="o">&gt;</span> <span class="n">ports</span><span class="p">;</span>
  <span class="n">ports</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">ports</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="further-reading">
<h2>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<p>For a more in depth (and historical) discussion, see <a class="reference external" href="http://fuelcycle.org/cep/cep18.html">CEP 18</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../index.html" title="index">
          <img class="logo" src="../_static/big_c.png" alt="Logo"/>
        </a></p><div class="sphinxlocaltoc">
    <h3><a href="../index.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Dynamic Resource Exchange</a><ul>
<li><a class="reference internal" href="#request-for-bids-phase">Request For Bids Phase</a></li>
<li><a class="reference internal" href="#response-to-request-for-bids-phase">Response to Request For Bids Phase</a><ul>
<li><a class="reference internal" href="#black-box-examples">Black Box Examples</a></li>
<li><a class="reference internal" href="#white-box-examples">White Box Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#preference-adjustment-phase">Preference Adjustment Phase</a><ul>
<li><a class="reference internal" href="#id1">Black Box Examples</a></li>
<li><a class="reference internal" href="#id2">White Box Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#solution-phase">Solution Phase</a></li>
<li><a class="reference internal" href="#trade-execution-phase">Trade Execution Phase</a></li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#mixin-based-trader-behavior">Mixin-based Trader Behavior</a></li>
<li><a class="reference internal" href="#non-black-box-behavior">Non-Black Box Behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#further-reading">Further Reading</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="resources.html"
                          title="Previous page">&larr; Resources</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="dbtypes.html"
                          title="Next page">&rarr; Database Types</a></p>
  </div>
  <div class="sphinxlocaltoc">
  <h3>Useful Pages</h3>
    <ul><li><ul>
    <li><a href="http://fuelcycle.org/user/index.html">User Guide</a></li>
    <li><a href="http://fuelcycle.org/arche/index.html">Archetype Developer Guide</a></li>
    <li><a href="http://fuelcycle.org/cyclus/api/">Cyclus API Documentation</a></li>
    <li><a href="http://fuelcycle.org/cycamore/api/">Cycamore API Documentation</a></li>
    <li><a href="http://fuelcycle.org/basics/glossary.html">Glossary</a></li>
    <li><a href="mailto:cyclus-users+subscribe@googlegroups.com?subject=Subscribe&body=Send this message to subscribe to the list">Join</a> the 
      <a href="https://groups.google.com/forum/#!forum/cyclus-users" target="_blank"><span style="font-variant:small-caps">Cyclus</span> Users</a> mailing list.
    <li><a href="mailto:cyclus-dev+subscribe@googlegroups.com?subject=Subscribe&body=Send this message to subscribe to the list">Join</a> the 
      <a href="https://groups.google.com/forum/#!forum/cyclus-users" target="_blank"><span style="font-variant:small-caps">Cyclus</span> Developers</a> mailing list.
    </ul></li></ul>
  </div>
    
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
    <h3>Get Cyclus</h3>
    <br>
    Current version: <b>1.2.0</b>
    <br><br>
    Install:
    <div class="highlight-bash" style="width:97.5%"><div class="highlight"><pre><span class="nv">$ </span>conda install cyclus cycamore</pre></div></div>
    Get the Source:
    <ul><li><ul>
          <li><a href="https://github.com/cyclus/cyclus">Cyclus</a></li>
          <li><a href="https://github.com/cyclus/cycamore">Cycamore</a></li>
    </ul></li></ul>
    <h3>Acknowledgements</h3>
    The Cyclus project has received support from:
    <br />
    <a href="http://www.neup.gov" target="_blank"><img src="../_static/neup_logo_large.png" width=170px></a>
    <br />
    <br />

    In addition, some of the students working on Cyclus have received support from:
    <br />
    <a href="http://www.anl.gov" target="_blank"><img src="../_static/AnlLogo.png" height=100px></a>
    <a href="http://www.nrc.gov" target="_blank"><img src="../_static/USNRC.png" height=100px></a>
    <br />
    <a href="http://www.neup.gov" target="_blank"><img src="../_static/neup_logo_large.png" width=170px></a>
    <br />
    <a href="http://www.nsf.gov" target="_blank"><img src="../_static/nsf_logo.png" height=100px></a>
    <a href="http://www.wisc.edu" target="_blank"><img src="../_static/crest.png" height=100px></a>

    

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="dbtypes.html" title="Database Types"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="resources.html" title="Resources"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &raquo;</li>

          <li><a href="index.html" ><span style="font-variant:small-caps;">Cyclus</span> Archetype Developer Guide</a> &raquo;</li> 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2012-2014, University of Wisconsin Computational Nuclear Engineering Research Group.
      Last updated on Mar 30, 2015.
    </div><script type="text/javascript">
    if(ga_enabled){
        document.write("<div class=\"footer\">This page uses <a href=\"http://analytics.google.com\">Google Analytics</a> to collect statistics. ");
        document.write("Click <button title=\"set cookie to disable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', 'true', {expires: 3650, path: '/'}); window.location.reload(); return false; \">here</button> to disable analytics for this site.");
        document.write("</div>");
    }else{
        document.write("<div class=\"footer\">Google Analytics has been disabled. ");
        document.write("Click <button title=\"set cookie to re-enable analytics for this site\" class=\"link\" onclick=\"$.cookie('disable-ga', null, {path: '/'}); window.location.reload(); return false; \">here</button> to re-enable analytics for this site.");
    };
</script>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>